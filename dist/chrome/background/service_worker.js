(()=>{"use strict";console.log("Hello from the background script!");const e=[{id:"uppercase",title:"Uppercase",systemPrompt:void 0},{id:"lowercase",title:"Lowercase",systemPrompt:void 0},{id:"capitalize",title:"Capitalize",systemPrompt:void 0}],t=[{title:"Proofread",systemPrompt:"fix typos and grammar",id:"proofread"},{title:"Rewrite",systemPrompt:"fix typos and grammar",id:"rewrite"},{title:"Professional",systemPrompt:"make it more professional",id:"pro"},{title:"Friendly",systemPrompt:"make it more friendly",id:"friendly"},{title:"Concise",systemPrompt:"make it more concise",id:"concise"}];chrome.runtime.onInstalled.addListener((o=>{console.log("onInstalled triggered");const s=indexedDB.open("actions");let n;if(console.log("database opened"),s.onupgradeneeded=()=>{const e=s.result.createObjectStore("actions",{keyPath:"id"});console.log(`object store ${e} created`),e.createIndex("by_title","title",{unique:!0}),e.createIndex("by_prompt","prompt");for(const o of t)e.put(o)},s.onsuccess=()=>{n=s.result},"install"===o.reason||"update"===o.reason){chrome.contextMenus.create({id:"ConTextParent",title:"ConText Tools",contexts:["selection"]});for(const t of e)chrome.contextMenus.create({id:t.id,parentId:"ConTextParent",title:t.title,contexts:["selection"]});for(const e of t)chrome.contextMenus.create({id:e.id,parentId:"ConTextParent",title:e.title,contexts:["selection"]})}})),chrome.contextMenus.onClicked.addListener(((o,s)=>{const n=e.find((e=>e.id===o.menuItemId))||t.find((e=>e.id===o.menuItemId));n&&s&&void 0!==s.id&&(async()=>{const[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0}),t=await chrome.tabs.sendMessage(e.id||0,{menuId:n.id,menuTitle:n.title,menuPrompt:n.systemPrompt});console.log(t)})()})),chrome.runtime.onMessage.addListener(((e,t,o)=>{console.log(t.tab?`from a content script:${t.tab.url}`:"from the extension"),e.id&&e.title&&e.prompt&&(chrome.contextMenus.create({id:e.id,parentId:"ConTextParent",title:e.title,contexts:["selection"]}),o({status:"success"}))}))})();